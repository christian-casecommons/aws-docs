<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>CloudFormation Resources - Infrastructure Accelerator Tutorial</title>
    <meta name="generator" content="Hugo 0.19" />

    
    <meta name="description" content="Infrastructure Accelerator Tutorial">
    
    <link rel="canonical" href="https://casecommons.github.io/aws-docs/cloudformation-resources/">
    
    <meta name="author" content="Justin Menga">
    

    <meta property="og:url" content="https://casecommons.github.io/aws-docs/cloudformation-resources/">
    <meta property="og:title" content="Infrastructure Accelerator Tutorial">
    <meta property="og:image" content="https://casecommons.github.io/aws-docs/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Infrastructure Accelerator Tutorial">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://casecommons.github.io/aws-docs/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://casecommons.github.io/aws-docs/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://casecommons.github.io/aws-docs/fonts/icon.eot');
        src: url('https://casecommons.github.io/aws-docs/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://casecommons.github.io/aws-docs/fonts/icon.woff')
               format('woff'),
             url('https://casecommons.github.io/aws-docs/fonts/icon.ttf')
               format('truetype'),
             url('https://casecommons.github.io/aws-docs/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://casecommons.github.io/aws-docs/stylesheets/application.css">
    <link rel="stylesheet" href="https://casecommons.github.io/aws-docs/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://casecommons.github.io/aws-docs/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://casecommons.github.io/aws-docs/stylesheets/highlight/highlight.css">
    <link rel="stylesheet" href="https://casecommons.github.io/aws-docs/stylesheets/overrides.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://casecommons.github.io/aws-docs/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        CloudFormation Resources
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/jmenga" title="@jmenga on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/mixja" title="@mixja on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://casecommons.github.io/aws-docs/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://casecommons.github.io/aws-docs/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Infrastructure Accelerator Tutorial <span class="version">v0.2</span></strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="https://casecommons.github.io/aws-docs/">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Local Setup" href="https://casecommons.github.io/aws-docs/local-setup/">
	
	Local Setup
</a>



  
</li>



<li>
  
    



<a  title="Security Resources" href="https://casecommons.github.io/aws-docs/security-resources/">
	
	Security Resources
</a>



  
</li>



<li>
  
    



<a class="current" title="CloudFormation Resources" href="https://casecommons.github.io/aws-docs/cloudformation-resources/">
	
	CloudFormation Resources
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Network Resources" href="https://casecommons.github.io/aws-docs/network-resources/">
	
	Network Resources
</a>



  
</li>



<li>
  
    



<a  title="EC2 Container Registry Resources" href="https://casecommons.github.io/aws-docs/ecr-resources/">
	
	EC2 Container Registry Resources
</a>



  
</li>



<li>
  
    



<a  title="Web Proxy Stack" href="https://casecommons.github.io/aws-docs/web-proxy/">
	
	Web Proxy Stack
</a>



  
</li>



<li>
  
    



<a  title="Intake API Stack" href="https://casecommons.github.io/aws-docs/intake-api/">
	
	Intake API Stack
</a>



  
</li>



<li>
  
    



<a  title="Intake Accelerator Stack" href="https://casecommons.github.io/aws-docs/intake-accelerator/">
	
	Intake Accelerator Stack
</a>



  
</li>



<li>
  
    



<a  title="Jenkins Stack" href="https://casecommons.github.io/aws-docs/jenkins/">
	
	Jenkins Stack
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/jmenga" target="_blank" title="@jmenga on Twitter">
              @jmenga on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/mixja" target="_blank" title="@mixja on GitHub">
              @mixja on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:justin.menga@gmail.com" title="Email of justin.menga@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>CloudFormation Resources </h1>

			

<h2 id="introduction">Introduction</h2>

<p>The <a href="https://github.com/casecommons/aws-cloudformation">aws-cloudformation</a> role includes a <a href="https://github.com/casecommons/aws-cloudformation/blob/master/templates/cfn.yml.j2">CloudFormation resources template</a> that is designed to define the following AWS resources:</p>

<ul>
<li>S3 bucket for CloudFormation templates</li>
<li>S3 bucket for Lambda functions used to support CloudFormation custom resources</li>
<li>Key Management Service (KMS) Key used for secrets management in CloudFormation stacks</li>
</ul>

<p>By default, without any custom configuration, the CloudFormation resources template will create each of the above resources.</p>

<p>The template currently includes some optional configuration parameters as described below:</p>

<ul>
<li><code>config_cfn_lambda_remote_accounts</code> - optional list of accounts that the S3 bucket for Lambda functions will be shared with.</li>
<li><code>config_cfn_kms_admins</code> - optional list of IAM roles that have administration level access to manage the KMS key.<br />
By default the <strong>admin</strong> role created by the <a href="https://casecommons.github.io/aws-docs/security-resources/">security resources playbook</a> is granted this access.</li>
<li><code>config_cfn_kms_encrypters</code> - optional list of IAM roles that have permission to encrypt ciphertext using the KMS key.<br />
By default the <strong>admin</strong> role created by the <a href="https://casecommons.github.io/aws-docs/security-resources/">security resources playbook</a> is granted this access.</li>
<li><code>config_cfn_kms_decrypters</code> - optional list of IAM roles that have permission to decrypt ciphertext using the KMS key.<br />
By default the <strong>admin</strong> role created by the <a href="https://casecommons.github.io/aws-docs/security-resources/">security resources playbook</a> is granted this access.</li>
</ul>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before commencing the tasks below, ensure you have successfully completed all tasks in <a href="https://casecommons.github.io/aws-docs/security-resources/">Security Resources</a>.</p>
</div>

<h2 id="creating-the-playbook">Creating the Playbook</h2>

<p>We will get started by establishing a CloudFormation resources playbook that defines CloudFormation resources for <strong>Demo Resources</strong> account.</p>

<p>1. Clone the <a href="https://github.com/casecommons/aws-starter">AWS Starter</a> to a local folder called <code>demo-cloudformation-resources</code> and re-initialise the Git repository.</p>

<pre><code class="language-bash">$ git clone git@github.com:casecommons/aws-starter.git demo-cloudformation-resources
  Cloning into 'demo-cloudformation-resources'...
  remote: Counting objects: 22, done.
  remote: Compressing objects: 100% (14/14), done.
  remote: Total 22 (delta 4), reused 22 (delta 4), pack-reused 0
  Receiving objects: 100% (22/22), done.
  Resolving deltas: 100% (4/4), done
$ cd demo-cloudformation-resources
$ rm -rf .git
$ git init
Initialized empty Git repository in /Users/jmenga/Source/casecommons/demo-cloudformation-resources/.git/
</code></pre>

<p>2.  Update the <code>roles/requirements.yml</code> file to the desired versions for each role:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="c1"># You can specify git tag, commit or branch for the version property</span>
<span class="o">-</span> <span class="n">src</span><span class="p">:</span> <span class="n">git</span><span class="nd">@github.com</span><span class="p">:</span><span class="n">casecommons</span><span class="o">/</span><span class="n">aws</span><span class="o">-</span><span class="n">cloudformation</span><span class="o">.</span><span class="n">git</span>
  <span class="n">scm</span><span class="p">:</span> <span class="n">git</span>
<span class="hll">  <span class="n">version</span><span class="p">:</span> <span class="mf">0.7</span><span class="o">.</span><span class="mi">0</span>
</span>  <span class="n">name</span><span class="p">:</span> <span class="n">aws</span><span class="o">-</span><span class="n">cloudformation</span>
<span class="o">-</span> <span class="n">src</span><span class="p">:</span> <span class="n">git</span><span class="nd">@github.com</span><span class="p">:</span><span class="n">casecommons</span><span class="o">/</span><span class="n">aws</span><span class="o">-</span><span class="n">sts</span><span class="o">.</span><span class="n">git</span>
  <span class="n">scm</span><span class="p">:</span> <span class="n">git</span>
<span class="hll">  <span class="n">version</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">.</span><span class="mi">2</span>
</span>  <span class="n">name</span><span class="p">:</span> <span class="n">aws</span><span class="o">-</span><span class="n">sts</span>
</code></pre></div>


<p>3.  Install the roles using the <code>ansible-galaxy</code> command as demonstrated below:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="err">$</span> <span class="n">ansible</span><span class="o">-</span><span class="n">galaxy</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">roles</span><span class="o">/</span><span class="n">requirements</span><span class="o">.</span><span class="n">yml</span> <span class="o">--</span><span class="n">force</span>
<span class="o">-</span> <span class="n">extracting</span> <span class="n">aws</span><span class="o">-</span><span class="n">cloudformation</span> <span class="n">to</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">jmenga</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">casecommons</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">cloudformation</span><span class="o">-</span><span class="n">resources</span><span class="o">/</span><span class="n">roles</span><span class="o">/</span><span class="n">aws</span><span class="o">-</span><span class="n">cloudformation</span>
<span class="o">-</span> <span class="n">aws</span><span class="o">-</span><span class="n">cloudformation</span> <span class="n">was</span> <span class="n">installed</span> <span class="n">successfully</span>
<span class="o">-</span> <span class="n">extracting</span> <span class="n">aws</span><span class="o">-</span><span class="n">sts</span> <span class="n">to</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">jmenga</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">casecommons</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">cloudformation</span><span class="o">-</span><span class="n">resources</span><span class="o">/</span><span class="n">roles</span><span class="o">/</span><span class="n">aws</span><span class="o">-</span><span class="n">sts</span>
<span class="o">-</span> <span class="n">aws</span><span class="o">-</span><span class="n">sts</span> <span class="n">was</span> <span class="n">installed</span> <span class="n">successfully</span>
</code></pre></div>


<p>4.  Modify the <code>group_vars/all/vars.yml</code> file, which contains global settings for the playbook:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="c1"># Stack Settings</span>
<span class="n">cf_stack_name</span><span class="p">:</span> <span class="n">cloudformation</span><span class="o">-</span><span class="n">resources</span>
<span class="hll"><span class="n">cf_stack_template</span><span class="p">:</span> <span class="s2">&quot;templates/cfn.yml.j2&quot;</span>
</span><span class="n">cf_stack_tags</span><span class="p">:</span>
  <span class="n">org</span><span class="p">:</span><span class="n">business</span><span class="p">:</span><span class="n">owner</span><span class="p">:</span> <span class="n">Casecommons</span>
  <span class="n">org</span><span class="p">:</span><span class="n">business</span><span class="p">:</span><span class="n">product</span><span class="p">:</span> <span class="n">CloudFormation</span> <span class="n">Resources</span>
  <span class="n">org</span><span class="p">:</span><span class="n">business</span><span class="p">:</span><span class="n">severity</span><span class="p">:</span> <span class="n">High</span>
  <span class="n">org</span><span class="p">:</span><span class="n">tech</span><span class="p">:</span><span class="n">environment</span><span class="p">:</span> <span class="s2">&quot;{{ env }}&quot;</span>
  <span class="n">org</span><span class="p">:</span><span class="n">tech</span><span class="p">:</span><span class="n">contact</span><span class="p">:</span> <span class="n">pema</span><span class="nd">@casecommons.org</span>
  
<span class="c1"># CloudFormation settings</span>
<span class="c1"># This sets a policy that disables updates to existing resources</span>
<span class="c1"># This requires you to explicitly set the cf_disable_stack_policy flag to true when running the playbook</span>
<span class="n">cf_stack_policy</span><span class="p">:</span>
  <span class="n">Statement</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">Effect</span><span class="p">:</span> <span class="s2">&quot;Deny&quot;</span>
    <span class="n">Action</span><span class="p">:</span> <span class="s2">&quot;Update:*&quot;</span>
    <span class="n">Principal</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
    <span class="n">Resource</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
</code></pre></div>


<p>Notice that we reference the <a href="https://github.com/casecommons/aws-cloudformation/blob/master/templates/cfn.yml.j2">templates/cfn.yml.y2 template</a> that is embedded within the <a href="https://github.com/casecommons/aws-cloudformation">aws-cloudformation role</a>.</p>

<p>5. Remove the local <code>templates</code> folder, since we are using a template that is embedded within the <code>aws-cloudformation</code> role:</p>

<pre><code class="language-bash">$ rm -rf templates
</code></pre>

<h2 id="defining-a-new-environment">Defining a New Environment</h2>

<p>We will now add a new environment called <strong>demo-resources</strong> to the playbook, which will be used to create CloudFormation resources in the <strong>demo-resources</strong> account.</p>

<p>1. Modify the <code>inventory</code> file so that it defines a single environment called <strong>demo-resources</strong>, ensuring you specify <code>ansible_connection=local</code>:</p>

<pre><code class="language-toml">[demo-resources]
demo-resources ansible_connection=local
</code></pre>

<p>2. Remove the <code>group_vars/non-prod</code> environment folder that is included in the starter template:</p>

<pre><code class="language-bash">$ rm -rf group_vars/non-prod
</code></pre>

<p>3. Create a file called <code>group_vars/demo-resources/vars.yml</code>, which will hold all environment specific configuration for the <strong>demo-resources</strong> environment:</p>

<pre><code class="language-bash">$ mkdir -p group_vars/demo-resources
$ touch group_vars/demo-resources/vars.yml
</code></pre>

<p>4. Finally add the <code>sts_role_arn</code> setting to <code>group_vars/demo-resources/vars.yml</code>:</p>

<pre><code class="language-python"># STS role in the target AWS account to assume
sts_role_arn: &quot;arn:aws:iam::094411466117:role/admin&quot;
</code></pre>

<h2 id="running-the-playbook">Running the Playbook</h2>

<p>The CloudFormation template in the <code>aws-cloudformation</code> role will create the following resources by default:</p>

<ul>
<li>An S3 bucket for CloudFormation templates</li>
<li>An S3 bucket for Lambda functions used to support CloudFormation custom resources</li>
<li>A Key Management Service (KMS) Key used for secrets management in CloudFormation stacks</li>
</ul>

<p>Let&rsquo;s now run the playbook to create these resources.</p>

<p>1. Ensure your local AWS environment is configured to target the <strong>demo-resources</strong> account:</p>

<pre><code class="language-bash">$ export AWS_PROFILE=demo-resources-admin
</code></pre>

<p>2. Run the Ansible playbook targeting the <code>demo-resources</code> environment as demonstrated below:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ ansible-playbook site.yml -e <span class="nv">env</span><span class="o">=</span>demo-resources

PLAY <span class="o">[</span>Assume Role<span class="o">]</span> *************************************************************

TASK <span class="o">[</span>aws-sts : set_fact<span class="o">]</span> ******************************************************
ok: <span class="o">[</span>demo-resources<span class="o">]</span>

TASK <span class="o">[</span>aws-sts : checking <span class="k">if</span> sts functions are sts_disabled<span class="o">]</span> ********************
skipping: <span class="o">[</span>demo-resources<span class="o">]</span>

TASK <span class="o">[</span>aws-sts : setting empty sts_session_output result<span class="o">]</span> ***********************
skipping: <span class="o">[</span>demo-resources<span class="o">]</span>

TASK <span class="o">[</span>aws-sts : setting sts_creds <span class="k">if</span> legacy AWS credentials are present <span class="o">(</span>e.g. <span class="k">for</span> Ansible Tower<span class="o">)]</span> ***
skipping: <span class="o">[</span>demo-resources<span class="o">]</span>

TASK <span class="o">[</span>aws-sts : assume sts role<span class="o">]</span> ***********************************************
Enter MFA code: ******
ok: <span class="o">[</span>demo-resources<span class="o">]</span>
...
...
TASK <span class="o">[</span>aws-cloudformation : <span class="nb">set</span> <span class="nb">local</span> path fact <span class="k">if</span> s3 upload disabled<span class="o">]</span> **********
ok: <span class="o">[</span>demo-resources<span class="o">]</span>

TASK <span class="o">[</span>aws-cloudformation : configure application stack<span class="o">]</span> ************************
...
...
PLAY RECAP *********************************************************************
demo-resources             : <span class="nv">ok</span><span class="o">=</span><span class="m">20</span>   <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>


<p>3.  The playbook will take a few minutes to create the CloudFormation stack and associated resources.  Whilst the CloudFormation stack is being created, you can review the CloudFormation stack that was generated in the <code>build/&lt;timestamp&gt;</code> folder:</p>

<pre><code class="language-bash">$ tree build
build
└── 20170226195006
    ├── cloudformation-resources-config.json
    ├── cloudformation-resources-policy.json
    ├── cloudformation-resources-stack.json
    └── cloudformation-resources-stack.yml
</code></pre>

<p>The following shows the <code>cloudformation-resources-stack.yml</code> file that was generated and uploaded to CloudFormation:</p>

<pre><code class="language-yaml">AWSTemplateFormatVersion: &quot;2010-09-09&quot;

Description: CloudFormation Resources

Resources:
  CfnTemplatesBucket:
    Type: &quot;AWS::S3::Bucket&quot;
    Properties:
      BucketName:
        Fn::Sub: &quot;${AWS::AccountId}-cfn-templates&quot;
      Tags:
        - Key: Name
          Value: 
            Fn::Sub: &quot;${AWS::AccountId}-cfn-templates&quot;
  CfnLambdaBucket:
    Type: &quot;AWS::S3::Bucket&quot;
    Properties:
      BucketName: 
        Fn::Sub: &quot;${AWS::AccountId}-cfn-lambda&quot;
      VersioningConfiguration:
        Status: &quot;Enabled&quot;
      Tags:
        - Key: Name
          Value:
            Fn::Sub: &quot;${AWS::AccountId}-cfn-lambda&quot;
  CfnMasterKey:
    Type: &quot;AWS::KMS::Key&quot;
    Properties:
      Description: 
        Fn::Sub: &quot;Credential Store Master Key for ${AWS::StackName}&quot;
      Enabled: &quot;true&quot;
      KeyPolicy:
        Version: &quot;2012-10-17&quot;
        Id: &quot;key-policy&quot;
        Statement: 
          - Sid: &quot;Allow root account access to key&quot;
            Effect: &quot;Allow&quot;
            Principal:
              AWS:
                Fn::Sub: &quot;arn:aws:iam::${AWS::AccountId}:root&quot;
            Action: &quot;kms:*&quot;
            Resource: &quot;*&quot;
          - Sid: &quot;Allow administration of the key&quot;
            Effect: &quot;Allow&quot;
            Principal:
              AWS:
              - Fn::Sub: &quot;arn:aws:iam::${AWS::AccountId}:role/admin&quot;
            Action:
            - &quot;kms:Create*&quot;
            - &quot;kms:Describe*&quot;
            - &quot;kms:Enable*&quot;
            - &quot;kms:List*&quot;
            - &quot;kms:Put*&quot;
            - &quot;kms:Update*&quot;
            - &quot;kms:Revoke*&quot;
            - &quot;kms:Disable*&quot;
            - &quot;kms:Get*&quot;
            - &quot;kms:Delete*&quot;
            - &quot;kms:ScheduleKeyDeletion&quot;
            - &quot;kms:CancelKeyDeletion&quot;
            Resource: &quot;*&quot;
          - Sid: &quot;Allow encryption use&quot;
            Effect: &quot;Allow&quot;
            Principal:
              AWS:
              - Fn::Sub: &quot;arn:aws:iam::${AWS::AccountId}:role/admin&quot;
            Action:
            - &quot;kms:Encrypt&quot;
            - &quot;kms:ReEncrypt*&quot;
            - &quot;kms:GenerateDataKey*&quot;
            - &quot;kms:DescribeKey&quot;
            Resource: &quot;*&quot;
          - Sid: &quot;Allow decryption use&quot;
            Effect: &quot;Allow&quot;
            Principal:
              AWS:
              - Fn::Sub: &quot;arn:aws:iam::${AWS::AccountId}:role/admin&quot;
            Action:
            - &quot;kms:Decrypt&quot;
            - &quot;kms:DescribeKey&quot;
            Resource: &quot;*&quot;
Outputs:
  CfnTemplatesBucketName:
    Description: &quot;CloudFormation Templates Bucket Name&quot;
    Value:
      Fn::Sub: &quot;${CfnTemplatesBucket.DomainName}&quot;
    Export:
      Name: &quot;CfnTemplatesBucket&quot;
  CfnTemplatesBucketURL:
    Description: &quot;CloudFormation Templates Bucket URL&quot;
    Value: 
      Fn::Sub: &quot;${CfnTemplatesBucket.WebsiteURL}&quot;
    Export:
      Name: &quot;CfnTemplatesBucketURL&quot;
  CfnMasterKey:
    Description: &quot;CloudFormation Master Key ID&quot;
    Value: 
      Fn::Sub: &quot;${CfnMasterKey}&quot;
    Export:
      Name: &quot;CfnMasterKey&quot;
  CfnMasterKeyArn:
    Description: &quot;CloudFormation Master Key ARN&quot;
    Value: 
      Fn::Sub: &quot;${CfnMasterKey.Arn}&quot;
    Export:
      Name: &quot;CfnMasterKeyArn&quot;
  CfnLambdaBucketName:
    Description: &quot;CloudFormation Lambda Bucket Name&quot;
    Value: 
      Fn::Sub: &quot;${CfnLambdaBucket.DomainName}&quot;
    Export:
      Name: &quot;CfnLambdaBucket&quot;
  CfnLambdaBucketURL:
    Description: &quot;CloudFormation Lambda Bucket URL&quot;
    Value: 
      Fn::Sub: &quot;${CfnLambdaBucket.WebsiteURL}&quot;
    Export:
      Name: &quot;CfnLambdaBucketURL&quot;
</code></pre>

<p>4. Once the playbook execution completes successfully, login to the <strong>demo-resources</strong> account.  You should see a new CloudFormation stack called <code>cloudformation-resources</code>:</p>

<p><img src="https://casecommons.github.io/aws-docs/images/cloudformation-resources.png" alt="CloudFormation Resources Stack" /></p>

<p>Notice that two S3 buckets and a KMS key have been created.</p>

<p>5. Select the <strong>CloudFormation</strong> dropdown and click on <strong>Exports</strong>:</p>

<p><img src="https://casecommons.github.io/aws-docs/images/cloudformation-exports.png" alt="Selecting CloudFormation Exports" /></p>

<p>6. Notice that a number of CloudFormation exports have been created by both the <strong>security-resources</strong> and <strong>cloudformation-resources</strong> stacks.  These exports can be referenced in other stacks by their logical <strong>Export Name</strong> using the CloudFormation <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-importvalue.html">Fn::ImportValue intrinsic function</a>, making it easier to consume these resources.</p>

<p><img src="https://casecommons.github.io/aws-docs/images/cfn-cloudformation-exports.png" alt="CloudFormation Exports" /></p>

<h2 id="wrap-up">Wrap Up</h2>

<p>We created CloudFormation resources in our <strong>demo-resources</strong> account, which provide the supporting resources for creating additional CloudFormation stacks that require features such as CloudFormation custom resources and secrets management.</p>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At this point you should commit your changes to the CloudFormation resources playbook before continuing.</p>
</div>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the AGPL license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://casecommons.github.io/aws-docs/security-resources/" title="Security Resources">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Security Resources
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://casecommons.github.io/aws-docs/network-resources/" title="Network Resources">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Network Resources
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://casecommons.github.io/aws-docs/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

